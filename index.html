<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CDC Planet Habitability</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Welcome to CDC Planet Habitability</h1>
    <p>Explore exoplanets and their potential for life!</p>
  </header>

  <main>
    <section class="info">
      <h2>Habitable Zone Planets</h2>
      <table id="planet-table">
        <thead>
          <tr>
            <th data-column="Planet Name">Planet Name</th>
            <th data-column="Host name">Host Name</th>
            <th data-column="Distance [pc]">Distance (pc)</th>
            <th data-column="Planet radius (earth radius)">Radius (Earth)</th>
            <th data-column="Insolation Flux [Earth Flux]">Insolation Flux</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <footer>
    <p>© 2025 CDC Planet Habitability</p>
  </footer>

  <script>
    const tooltip = document.createElement("div");
    tooltip.className = "tooltip";
    document.body.appendChild(tooltip);

    let currentClicked = null;

    fetch("hz_planets.json")
      .then(response => response.json())
      .then(data => {
        const tbody = document.querySelector("#planet-table tbody");

        data.forEach(planet => {
          const row = document.createElement("tr");

          // Planet name cell with hover + click
          const nameCell = document.createElement("td");
          nameCell.textContent = planet["Planet Name"];
          nameCell.style.cursor = "pointer";

          function positionTooltip() {
            const rect = nameCell.getBoundingClientRect();
            tooltip.style.top = (window.scrollY + rect.bottom + 5) + "px";
            tooltip.style.left = (window.scrollX + rect.left) + "px";
          }

          nameCell.addEventListener("mouseenter", () => {
            if (currentClicked !== nameCell) {
              tooltip.innerHTML = `
                <strong>${planet["Planet Name"]}</strong><br>
                Host: ${planet["Host name"]}<br>
                Distance: ${planet["Distance [pc]"]} pc<br>
                Radius: ${planet["Planet radius (earth radius)"]} R⊕
              `;
              tooltip.classList.add("show");
              positionTooltip();
            }
          });

          nameCell.addEventListener("mouseleave", () => {
            if (currentClicked !== nameCell) {
              tooltip.classList.remove("show");
            }
          });

          nameCell.addEventListener("click", (e) => {
            e.stopPropagation();
            if (currentClicked === nameCell) {
              currentClicked = null;
              tooltip.classList.remove("show");
              nameCell.classList.remove("clicked");
            } else {
              if (currentClicked) currentClicked.classList.remove("clicked");
              currentClicked = nameCell;
              nameCell.classList.add("clicked");
              tooltip.innerHTML = `
                <strong>${planet["Planet Name"]}</strong><br>
                Host: ${planet["Host name"]}<br>
                Distance: ${planet["Distance [pc]"]} pc<br>
                Radius: ${planet["Planet radius (earth radius)"]} R⊕
              `;
              tooltip.classList.add("show");
              positionTooltip();
            }
          });

          row.appendChild(nameCell);

          // Other columns
          row.innerHTML += `
            <td>${planet["Host name"]}</td>
            <td>${planet["Distance [pc]"]}</td>
            <td>${planet["Planet radius (earth radius)"]}</td>
            <td>${planet["Insolation Flux [Earth Flux]"]}</td>
          `;
          tbody.appendChild(row);
        });

        // Sorting functionality
        document.querySelectorAll("#planet-table th").forEach(header => {
          header.addEventListener("click", () => {
            const column = header.getAttribute("data-column");
            const rows = Array.from(tbody.querySelectorAll("tr"));
            const ascending = !header.classList.contains("asc");

            rows.sort((a, b) => {
              const valA = a.querySelector(`td:nth-child(${header.cellIndex + 1})`).innerText;
              const valB = b.querySelector(`td:nth-child(${header.cellIndex + 1})`).innerText;

              const numA = parseFloat(valA);
              const numB = parseFloat(valB);

              if (!isNaN(numA) && !isNaN(numB)) {
                return ascending ? numA - numB : numB - numA;
              } else {
                return ascending ? valA.localeCompare(valB) : valB.localeCompare(valA);
              }
            });

            tbody.innerHTML = "";
            rows.forEach(r => tbody.appendChild(r));

            document.querySelectorAll("#planet-table th").forEach(th => th.classList.remove("asc", "desc"));
            header.classList.add(ascending ? "asc" : "desc");
          });
        });
      });

    // Close pinned tooltip on outside click
    document.addEventListener("click", () => {
      if (currentClicked) {
        currentClicked.classList.remove("clicked");
        currentClicked = null;
        tooltip.classList.remove("show");
      }
    });

    // Keep tooltip pinned below clicked name on scroll
    window.addEventListener("scroll", () => {
      if (currentClicked) {
        const rect = currentClicked.getBoundingClientRect();
        tooltip.style.top = (window.scrollY + rect.bottom + 5) + "px";
        tooltip.style.left = (window.scrollX + rect.left) + "px";
      }
    });
  </script>
</body>
</html>