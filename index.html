<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CDC Planet Habitability</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Welcome to CDC Planet Habitability</h1>
    <p>Explore exoplanets and their potential for life!</p>
  </header>

  <main>
    <section class="info">
      <h2>Habitable Zone Planets</h2>
      <table id="planet-table">
        <thead>
          <tr>
            <th>Planet Name</th>
            <th>Host Name</th>
            <th>Distance (pc)</th>
            <th>Radius (Earth)</th>
            <th>Insolation Flux</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <footer>
    <p>Â© 2025 CDC Planet Habitability</p>
  </footer>

  <script>
    let openTooltip = null;
    let openName = null;

    async function fetchPlanetData(name) {
      const urlName = name.replace(/\s+/g, '_');
      try {
        const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${urlName}`);
        const data = await response.json();
        return data;
      } catch {
        return null;
      }
    }

    fetch("hz_planets.json")
      .then(response => response.json())
      .then(data => {
        const tbody = document.querySelector("#planet-table tbody");

        data.forEach(planet => {
          const row = document.createElement("tr");

          const nameCell = document.createElement("td");
          const nameSpan = document.createElement("span");
          nameSpan.textContent = planet["Planet Name"];
          nameSpan.classList.add("planet-name");
          nameSpan.dataset.name = planet["Planet Name"];

          const tooltip = document.createElement("div");
          tooltip.classList.add("tooltip");

          nameCell.appendChild(nameSpan);
          nameCell.appendChild(tooltip);
          row.appendChild(nameCell);

          ["Host name","Distance [pc]","Planet radius (earth radius)","Insolation Flux [Earth Flux]"].forEach(col => {
            const td = document.createElement("td");
            td.textContent = planet[col];
            row.appendChild(td);
          });

          tbody.appendChild(row);

          // Helper: position tooltip near the name span
          function positionTooltip() {
            const rect = nameSpan.getBoundingClientRect();
            const scrollY = window.scrollY || window.pageYOffset;
            const scrollX = window.scrollX || window.pageXOffset;
            const tooltipHeight = tooltip.offsetHeight;
            const tooltipWidth = tooltip.offsetWidth;
            const viewportHeight = window.innerHeight;
            const viewportWidth = window.innerWidth;

            let top = rect.bottom + scrollY + 5; // below by default
            let left = rect.left + scrollX;

            // If tooltip would go below viewport, place above
            if(top + tooltipHeight > scrollY + viewportHeight) {
              top = rect.top + scrollY - tooltipHeight - 5;
            }

            // If tooltip would go off right edge
            if(left + tooltipWidth > scrollX + viewportWidth) {
              left = viewportWidth - tooltipWidth - 10 + scrollX;
            }

            tooltip.style.top = top + "px";
            tooltip.style.left = left + "px";
          }

          // Hover: temporary tooltip
          nameSpan.addEventListener("mouseenter", async () => {
            if(openTooltip !== tooltip){ 
              tooltip.style.display = "block";
              positionTooltip();
              tooltip.innerHTML = "Loading...";
              const info = await fetchPlanetData(nameSpan.dataset.name);
              if(info){
                tooltip.innerHTML = `
                  <strong>${info.title}</strong><br>
                  ${info.thumbnail ? `<img src="${info.thumbnail.source}" width="200"><br>` : ''}
                  <div class="tooltip-text">${info.extract}</div>
                `;
              } else {
                tooltip.innerHTML = "<p>No information available</p>";
              }
            }
          });

          nameSpan.addEventListener("mouseleave", () => {
            if(openTooltip !== tooltip){
              tooltip.style.display = "none";
            }
          });

          // Click: persistent tooltip
          nameSpan.addEventListener("click", async (e) => {
            e.stopPropagation();

            if(openTooltip && openTooltip !== tooltip){
              openTooltip.style.display = "none";
              openName.classList.remove("selected");
            }

            if(openTooltip === tooltip){
              tooltip.style.display = "none";
              nameSpan.classList.remove("selected");
              openTooltip = null;
              openName = null;
            } else {
              tooltip.style.display = "block";
              nameSpan.classList.add("selected");
              openTooltip = tooltip;
              openName = nameSpan;

              positionTooltip();

              tooltip.innerHTML = "Loading...";
              const info = await fetchPlanetData(nameSpan.dataset.name);
              if(info){
                tooltip.innerHTML = `
                  <strong>${info.title}</strong><br>
                  ${info.thumbnail ? `<img src="${info.thumbnail.source}" width="200"><br>` : ''}
                  <div class="tooltip-text">${info.extract}</div>
                `;
              } else {
                tooltip.innerHTML = "<p>No information available</p>";
              }
            }
          });

          // Prevent closing tooltip when clicking inside it
          tooltip.addEventListener("click", (e) => e.stopPropagation());
        });

        // Click outside to close
        document.addEventListener("click", () => {
          if(openTooltip){
            openTooltip.style.display = "none";
            openName.classList.remove("selected");
            openTooltip = null;
            openName = null;
          }
        });
      });
  </script>
</body>
</html>