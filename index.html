<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CDC Planet Habitability</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Welcome to CDC Planet Habitability</h1>
    <p>Explore exoplanets and their potential for life!</p>
  </header>

  <main>
    <section class="info">
      <h2>Habitable Zone Planets</h2>
      <div class="table-container">
        <table id="planet-table">
          <thead>
            <tr>
              <th data-key="Planet Name">Planet Name</th>
              <th data-key="Host name">Host Name</th>
              <th data-key="Distance [pc]">Distance (pc)</th>
              <th data-key="Planet radius (earth radius)">Radius (Earth)</th>
              <th data-key="Semi-major Axis (AU)">Semi-major Axis (AU)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    <p>© 2025 CDC Planet Habitability</p>
  </footer>

  <div class="tooltip" id="tooltip"></div>

  <script>
    const tooltip = document.getElementById("tooltip");

    fetch("hz_planets.json")
      .then(response => response.json())
      .then(data => {
        const tbody = document.querySelector("#planet-table tbody");

        data.forEach(planet => {
          const row = document.createElement("tr");
          const nameCell = document.createElement("td");
          nameCell.textContent = planet["Planet Name"];
          nameCell.style.cursor = "pointer";

          // Hover tooltip (only shows if not pinned)
          nameCell.addEventListener("mouseenter", () => {
            if (!nameCell.classList.contains("clicked")) {
              tooltip.innerHTML = `
                <strong>${planet["Planet Name"]}</strong><br>
                Host: ${planet["Host name"]}<br>
                Distance: ${planet["Distance [pc]"]} pc<br>
                Radius: ${planet["Planet radius (earth radius)"]} R⊕<br>
                Semi-major Axis: ${planet["Semi-major Axis (AU)"]} AU
              `;
              tooltip.style.display = "block";
              positionTooltip(tooltip, nameCell);
            }
          });

          nameCell.addEventListener("mouseleave", () => {
            if (!nameCell.classList.contains("clicked")) {
              tooltip.style.display = "none";
            }
          });

          // Click to pin tooltip
          nameCell.addEventListener("click", () => {
            const currentlyClicked = document.querySelector("td.clicked");
            if (currentlyClicked && currentlyClicked !== nameCell) {
              currentlyClicked.classList.remove("clicked");
            }

            nameCell.classList.toggle("clicked");
            tooltip.innerHTML = `
              <strong>${planet["Planet Name"]}</strong><br>
              Host: ${planet["Host name"]}<br>
              Distance: ${planet["Distance [pc]"]} pc<br>
              Radius: ${planet["Planet radius (earth radius)"]} R⊕<br>
              Semi-major Axis: ${planet["Semi-major Axis (AU)"]} AU
            `;
            tooltip.style.display = nameCell.classList.contains("clicked") ? "block" : "none";
            positionTooltip(tooltip, nameCell);
          });

          row.appendChild(nameCell);
          row.innerHTML += `
            <td>${planet["Host name"]}</td>
            <td>${planet["Distance [pc]"]}</td>
            <td>${planet["Planet radius (earth radius)"]}</td>
            <td>${planet["Semi-major Axis (AU)"]}</td>
          `;
          tbody.appendChild(row);
        });
      });

    // Position tooltip relative to element
    function positionTooltip(tooltip, element) {
      const rect = element.getBoundingClientRect();
      const scrollY = window.scrollY || window.pageYOffset;
      const scrollX = window.scrollX || window.pageXOffset;

      let top = rect.bottom + scrollY + 5;
      let left = rect.left + scrollX;

      if(left + tooltip.offsetWidth > window.innerWidth - 10){
        left = window.innerWidth - tooltip.offsetWidth - 10;
      }
      if(top + tooltip.offsetHeight > window.innerHeight + scrollY - 10){
        top = rect.top + scrollY - tooltip.offsetHeight - 5;
      }

      tooltip.style.top = `${top}px`;
      tooltip.style.left = `${left}px`;
    }

    // Click outside to unpin tooltip
    document.addEventListener("click", e => {
      const clickedInside = e.target.closest("td");
      if (!clickedInside) {
        const clickedCell = document.querySelector("td.clicked");
        if (clickedCell) {
          clickedCell.classList.remove("clicked");
          tooltip.style.display = "none";
        }
      }
    });
  </script>
</body>
</html>